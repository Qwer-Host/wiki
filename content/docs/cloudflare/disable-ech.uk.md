---
title: "Вимкнення Encrypted Client Hello (ECH)"
description: "Детальне керівництво з вимкнення ECH на безкоштовному тарифі CloudFlare через API"
weight: 10
---

## Навіщо вимикати ECH?

Роскомнагляд заблокував технологію **Encrypted Client Hello (ECH)**, що викликало проблеми для користувачів Cloudflare в Росії. Більше того, Cloudflare примусово активував цю технологію для всіх користувачів, включаючи тих, хто знаходиться на безкоштовному тарифі.

У цьому гайді ми розберемо, як вимкнути ECH для вашого домену через Cloudflare API.

{{< callout type="warning" >}}
**Для користувачів з Росії:** Вимкнення ECH може бути необхідним для забезпечення доступності вашого сайту для російських користувачів через блокування цієї технології Роскомнаглядом.
{{< /callout >}}

---

## Крок 1: Перевірка увімкнення ECH

Перш ніж вимикати ECH, перевірте, чи увімкнений він для вашого домену. Це можна зробити за допомогою запиту до Google Public DNS:

1. Перейдіть за наступним посиланням, замінивши `[ВАШ_ДОМЕН]` на ім'я вашого домену:

```url
https://dns.google/resolve?name=[ВАШ_ДОМЕН]&type=HTTPS
```

2. Якщо в результатах видно, що ECH активний, переходьте до наступного кроку.

{{< callout type="info" >}}
**Приклад:** Для домену `example.com` посилання буде виглядати так:
```
https://dns.google/resolve?name=example.com&type=HTTPS
```
{{< /callout >}}

---

## Крок 2: Отримання даних для Cloudflare API

Для взаємодії з API вам знадобляться два ключові елементи:

### Global API Key

1. Перейдіть на [сторінку профілю Cloudflare](https://dash.cloudflare.com/profile/api-tokens)
2. Знайдіть розділ з вашим **Global API Key** та скопіюйте ключ

{{< callout type="warning" >}}
**Важливо:** Global API Key дає повний доступ до вашого акаунту. Ніколи не діліться ним з третіми особами та зберігайте в безпечному місці!
{{< /callout >}}

### Zone ID

1. Зайдіть до панелі керування вашим доменом у Cloudflare
2. Прокрутіть сторінку вниз у правій колонці
3. Скопіюйте значення **Zone ID**

{{< callout type="info" >}}
Zone ID — це унікальний ідентифікатор вашого домену в системі Cloudflare.
{{< /callout >}}

---

## Крок 3: Вимкнення ECH через Cloudflare API

### Спосіб 1: Використання команди curl

Для вимкнення ECH виконайте наступну команду в терміналі, замінивши `{ID_ZONE}`, `{ACCOUNT_EMAIL}` та `{GLOBAL_API_KEY}` на ваші дані:

```bash
curl -X PATCH "https://api.cloudflare.com/client/v4/zones/{ID_ZONE}/settings/ech" \
     -H "X-Auth-Email: {ACCOUNT_EMAIL}" \
     -H "X-Auth-Key: {GLOBAL_API_KEY}" \
     -H "Content-Type: application/json" \
     --data '{"id":"ech","value":"off"}'
```

**Приклад:**
```bash
curl -X PATCH "https://api.cloudflare.com/client/v4/zones/abc123def456/settings/ech" \
     -H "X-Auth-Email: user@example.com" \
     -H "X-Auth-Key: c2547eb745079dac9320b638f5e225cf483cc5cfdda41" \
     -H "Content-Type: application/json" \
     --data '{"id":"ech","value":"off"}'
```

{{< callout type="success" >}}
При успішному виконанні ви отримаєте JSON-відповідь з підтвердженням зміни налаштування.
{{< /callout >}}

### Спосіб 2: Використання Postman

Ви можете виконати цей запит через **Postman**, дотримуючись інструкцій:

#### 1. Налаштування запиту

- **Метод:** `PATCH`
- **URL:**
```
https://api.cloudflare.com/client/v4/zones/{ID_ZONE}/settings/ech
```

#### 2. Налаштування Headers

У розділі **Headers** додайте наступні поля:

| Key | Value |
|-----|-------|
| `X-Auth-Email` | ваш email-адрес Cloudflare |
| `X-Auth-Key` | ваш Global API Key |
| `Content-Type` | `application/json` |

#### 3. Налаштування Body

У розділі **Body** виберіть `raw` та `JSON`, потім введіть:

```json
{
  "id": "ech",
  "value": "off"
}
```

#### 4. Відправка запиту

Натисніть кнопку **Send** та дочекайтеся відповіді від сервера.

---

## Спосіб 3: У випадку з платним тарифом

Якщо ви використовуєте **платний тариф** Cloudflare, вимкнути ECH можна через інтерфейс панелі керування:

1. Перейдіть до розділу **SSL/TLS**
2. Відкрийте вкладку **Edge Certificates**
3. Знайдіть налаштування **Encrypted ClientHello (ECH)**
4. Встановіть значення **Disabled**

{{< callout type="info" >}}
**Зверніть увагу:** Ця опція доступна тільки для користувачів платних тарифів (Pro, Business, Enterprise).
{{< /callout >}}

---

## Перевірка результату

Після вимкнення ECH рекомендується перевірити зміни:

1. Зачекайте 5-10 хвилин для застосування налаштувань
2. Знову виконайте перевірку через Google Public DNS (Крок 1)
3. Перевірте доступність вашого сайту для користувачів з Росії

{{< callout type="success" >}}
**Готово!** ECH тепер вимкнений для вашого домену, і сайт має бути доступний для російських користувачів.
{{< /callout >}}

---

## Можливі проблеми та рішення

### Помилка аутентифікації

**Проблема:** Отримуєте помилку `Authentication error` або `Invalid credentials`

**Рішення:**
- Перевірте правильність email-адреси
- Переконайтеся, що скопіювали Global API Key повністю
- Перевірте, що не додали зайві пробіли при копіюванні

### Помилка Zone ID

**Проблема:** Отримуєте помилку `Zone not found`

**Рішення:**
- Переконайтеся, що Zone ID скопійований правильно
- Перевірте, що використовуєте Zone ID саме того домену, який хочете змінити

### ECH не вимикається

**Проблема:** Після виконання команди ECH залишається увімкненим

**Рішення:**
- Зачекайте 10-15 хвилин для застосування змін
- Очистіть DNS-кеш на вашому пристрої
- Повторіть запит до API

---

## Додаткові ресурси

- [Офіційна документація Cloudflare API](https://api.cloudflare.com/)
- [Керівництво з налаштування SSL/TLS в Cloudflare](https://developers.cloudflare.com/ssl/)
- [Спільнота Cloudflare](https://community.cloudflare.com/)

{{< callout type="info" >}}
**Потрібна допомога?** Якщо у вас виникли складнощі з вимкненням ECH, зверніться до підтримки Cloudflare або на форуми спільноти.
{{< /callout >}}
